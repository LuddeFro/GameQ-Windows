
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.net.URL;

public class DataModel {

	private static String filename;
	private String token;
	private String email;
	private String password;
	private boolean bolIsLoggedIn;
	private boolean bolIsRegisteredForNotifications;
	public Encryptor enc;
	
	public DataModel() {
		token = "";
		email = "";
		password = "";
		bolIsLoggedIn = false;
		bolIsRegisteredForNotifications = false;
		enc = new Encryptor();
		
		URL filenameex = DataModel.class.getResource("/res/stg.cdtx");
		filename = filenameex.toString();
		load();
		
		
		
	}
	
	public String getToken() {
		return token;
	}
	public String getEmail() {
		return email;
	}
	public String getPassword() {
		return password;
	}
	public boolean getBolIsLoggedIn() {
		return bolIsLoggedIn;
	}
	public boolean getBolIsRegisteredForNotifications() {
		return bolIsRegisteredForNotifications;
	}
	
	public void setToken(String token) {
		this.token = token;
	}
	public void setEmail(String email) {
		this.email = email;
	}
	public void setPassword(String password) {
		this.password = password;
	}
	public void setBolIsLoggedIn(boolean bolIsLoggedIn) {
		this.bolIsLoggedIn = bolIsLoggedIn;
	}
	public void setBolIsRegisteredForNotifications(boolean bolIsRegisteredForNotifications) {
		this.bolIsRegisteredForNotifications = bolIsRegisteredForNotifications;
	}
	
	
	
		
	
	public void save() {
		File file = new File(filename);
		if (file.exists() ) {
		       file.delete();       
		}   
		try {
			file.createNewFile();
		} catch (IOException e) {
			e.printStackTrace();
			return;
		} 
		
		byte[] pwd = enc.encrypt("email="+email+"&password="+password+"&token="+token+"&bolIsLoggedIn="+bolIsLoggedIn+"&bolIsRegisteredForNotifications="+bolIsRegisteredForNotifications);
		FileWriter fw;
		try {
			fw = new FileWriter(filename, true);
		} catch (IOException e) {
			e.printStackTrace();
			return;
		}
		BufferedWriter bw = new BufferedWriter(fw); 
		try {
			bw.write(pwd.toString());
		} catch (IOException e) {
			e.printStackTrace();
		}
		try {
			bw.close();
		} catch (IOException e) {
			e.printStackTrace();
			return;
		}
	}
	
	private void load() {
		StringBuilder fileString = new StringBuilder();
		System.out.println("foodstuffs");
		System.out.println(filename);
		System.out.println("shitstuff");
		File yourFile = new File(filename);
		if(!yourFile.exists()) {
		    try {
				yourFile.createNewFile();
			} catch (IOException e) {
				e.printStackTrace();
				return;
			}
		} 
		try (BufferedReader br = new BufferedReader(new FileReader(filename)))
		{
 
			String sCurrentLine;
 
			while ((sCurrentLine = br.readLine()) != null) {
				fileString.append(sCurrentLine);
			}
 
		} catch (IOException e) {
			e.printStackTrace();
		} 
		
		String fullString = fileString.toString();
		String fullDecrypted = enc.decrypt(fullString.getBytes());
		String[] splitString = fullDecrypted.split("&");
		if (splitString.length != 5) {
			return;
		}
		for (int i = 0; i < 5; i++) {
			String a = splitString[i];
			String[] b = a.split("=");
			splitString[i] = b[1];
		}
		email = splitString[0];
		password = splitString[1];
		token = splitString[2];
		bolIsLoggedIn = Boolean.parseBoolean(splitString[3]);
		bolIsRegisteredForNotifications = Boolean.parseBoolean(splitString[4]);
	}
	
}
